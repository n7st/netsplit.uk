<!doctype html><html lang=en><head><title>Remote Lab, Part 1: Pre-Installation Configuration :: netsplit</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Part 1 (Introduction, OVH configuration. You&amp;rsquo;re here!) Part 2 (Configuring Proxmox.) Part 3 (Installing pfSense.) Part 4 (Configuring pfSense.)  Overview This guide details how to set up a remote lab with a pfSense gateway on an OVH dedicated server, including basic firewall rules for managing access to the router&amp;rsquo;s web interface, and use of Let&amp;rsquo;s Encrypt for SSL certificates.
First, we&amp;rsquo;ll configure the server and its IP addresses."><meta name=keywords content><meta name=robots content="noodp"><link rel=canonical href=https://netsplit.uk/posts/2019/02/13/remote_proxmox_lab_intro/><link rel=stylesheet href=https://netsplit.uk/assets/style.css><link rel=stylesheet href=https://netsplit.uk/assets/green.css><link rel=apple-touch-icon href=https://netsplit.uk/img/apple-touch-icon-192x192.png><link rel="shortcut icon" href=https://netsplit.uk/img/favicon/green.png><meta name=twitter:card content="summary"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="og:title" content="Remote Lab, Part 1: Pre-Installation Configuration"><meta property="og:description" content="Part 1: Set up a dedicated server with multiple IP addresses.
Build a remote lab with Proxmox and pfSense on an OVH dedicated server."><meta property="og:url" content="https://netsplit.uk/posts/2019/02/13/remote_proxmox_lab_intro/"><meta property="og:site_name" content="netsplit"><meta property="og:image" content="https://netsplit.uk/img/favicon/green.png"><meta property="og:image:width" content="2048"><meta property="og:image:height" content="1024"><meta property="article:published_time" content="2019-02-13 20:05:24 +0000 UTC"></head><body class=green><div class="container full headings--one-size"><header class=header><div class=header__inner><div class=header__logo><a href=/><div class=logo>netsplit</div></a></div><div class=menu-trigger>menu</div></div></header><div class=content><div class=post><h1 class=post-title><a href=https://netsplit.uk/posts/2019/02/13/remote_proxmox_lab_intro/>Remote Lab, Part 1: Pre-Installation Configuration</a></h1><div class=post-meta><span class=post-date>2019-02-13 [Updated: 2019-02-13]</span></div><span class=post-tags>#<a href=https://netsplit.uk/tags/remote-lab/>Remote Lab</a>&nbsp;
#<a href=https://netsplit.uk/tags/ovh/>OVH</a>&nbsp;
#<a href=https://netsplit.uk/tags/networking/>Networking</a>&nbsp;</span><div class=post-content><div><ul><li><a href=#>Part 1 (Introduction, OVH configuration. You&rsquo;re here!)</a></li><li><a href=/posts/2019/02/13/configuring_proxmox/>Part 2 (Configuring Proxmox.)</a></li><li><a href=/posts/2019/02/17/installing_pfsense/>Part 3 (Installing pfSense.)</a></li><li><a href=/posts/2020/01/11/configuring_pfsense>Part 4 (Configuring pfSense.)</a></li></ul><h2 id=overview>Overview<a href=#overview class=hanchor arialabel=Anchor>&#8983;</a></h2><p>This guide details how to set up a remote lab with a
<a href=https://www.pfsense.org/>pfSense</a> gateway on an OVH dedicated server,
including basic firewall rules for managing access to the router&rsquo;s web
interface, and use of <a href=https://letsencrypt.org/>Let&rsquo;s Encrypt</a> for SSL
certificates.</p><p>First, we&rsquo;ll configure the server and its IP addresses.</p><h2 id=why>Why?<a href=#why class=hanchor arialabel=Anchor>&#8983;</a></h2><ul><li>Manage OVH&rsquo;s failover IP addresses in one place, rather than having to
manually set up the gateway on every single virtual machine.</li><li>Protect traffic to your virtual machines with one user-friendly firewall.</li><li>Use fewer IP addresses. Instead of having an address per machine, you can
forward ports to machines which do not have a public IP address.</li></ul><h2 id=requirements>Requirements<a href=#requirements class=hanchor arialabel=Anchor>&#8983;</a></h2><ol><li>An <a href=https://www.ovh.co.uk/>OVH</a> or <a href=https://www.soyoustart.com/en/>SoYouStart</a>
dedicated server. I am using a lower end SoYouStart server.</li><li>A domain name (and access to its DNS manager). In this example, I will use the
domain <code>example.com</code>.</li><li>Images for pfSense and (in this example) Ubuntu.</li></ol><h2 id=ovh-configuration>OVH configuration<a href=#ovh-configuration class=hanchor arialabel=Anchor>&#8983;</a></h2><h3 id=failover-ip-addresses>Failover IP addresses<a href=#failover-ip-addresses class=hanchor arialabel=Anchor>&#8983;</a></h3><p>OVH allow up to 16 extra free (after the initial setup fee) &ldquo;failover&rdquo; IP
addresses with their dedicated servers. These can be used to give a public IP
address to a virtual machine. For the sake of this guide, I have two failover IP
addresses: one for the router, and one for the first virtual machine, which I
will make publicly accessible.</p><ol><li>From the OVH control panel, select &ldquo;IP&rdquo;.</li><li>Select &ldquo;Order IPs&rdquo;.</li><li>Fill out the order form:<ul><li>Server: (choose your server&rsquo;s hostname)</li><li>Number of IPs: 1 address</li><li>Country: (your choice)</li><li>Accept the terms and conditions</li></ul></li><li>Repeat the process a second time for another IP address.</li></ol><p>You will shortly receive two e-mails with invoices. After paying, the orders can
take a while to fulfill. Once you receive confirmation that your addresses have
been set up, return to the IP management area to set up their virtual MAC
addresses.</p><ol><li>Select &ldquo;Manage IPs&rdquo;.</li><li>Select your server&rsquo;s hostname in the &ldquo;Service&rdquo; dropdown.</li><li>Click the &ldquo;settings&rdquo; icon (a cog) next to the first IP.</li><li>Select &ldquo;Add a virtual MAC&rdquo;.</li><li>Fill out the form:<ul><li>Name of VM: (this field is for display purposes only, so you can set the
name to whatever you like)</li><li>Type of virtual MAC: ovh</li><li>You want to: Create a new virtual MAC address</li></ul></li></ol><p>Next, set up the second failover IP address.</p><ol><li>Click the &ldquo;settings cog&rdquo; next to the second address.</li><li>Select &ldquo;Add a virtual MAC&rdquo;.</li><li>Set the VM name (this is required but can be anything).</li><li>Use the failover MAC address from the first failover IP.</li></ol><p>Again, fulfillment of the virtual MAC addresses can take a few minutes. You
won&rsquo;t receive an e-mail when they are finished, so check back later to find out.
After this, you should have a primary IP address with <strong>no</strong> virtual MAC
address, and two failover IP addresses with the <strong>same</strong> virtual MAC address.
The virtual MAC addresses should be the same because later on, we&rsquo;re going to
use a 1:1 NAT rule to route the second failover IP to a virtual machine. Any
further failover IP addresses added to the environment should also be
configured with the same virtual MAC address.</p><h2 id=ip-address-reference>IP address reference<a href=#ip-address-reference class=hanchor arialabel=Anchor>&#8983;</a></h2><p>For the rest of the guide, I will use the following (made up) examples:</p><h3 id=ovh-gateway-ip-addresses>OVH gateway IP addresses<a href=#ovh-gateway-ip-addresses class=hanchor arialabel=Anchor>&#8983;</a></h3><p>Gateway addresses for OVH IP addresses are the address, but with the last octet
changed to <code>254</code>. This means that our primary IP address (ex. <code>5.39.50.60</code>)
becomes <code>5.39.50.254</code>. This is documented in greater detail
<a href=https://docs.ovh.com/gb/en/dedicated/network-bridging/#determine-the-gateway-address>here</a>.</p><h3 id=subdomain-configuration>Subdomain configuration<a href=#subdomain-configuration class=hanchor arialabel=Anchor>&#8983;</a></h3><p>Later, we will need (well, <em>want</em>) subdomains for memorable access to the
services we&rsquo;re configuring. Add some A records using your DNS manager (replacing
my example names and addresses):</p><p>In the next part, we&rsquo;ll install and configure Proxmox on the dedicated server.</p><p><em><a href=/posts/2019/02/13/configuring_proxmox/>Read part 2</a></em></p></div></div><div class=pagination><div class=pagination__title><span class=pagination__title-h>Read other posts</span><hr></div><div class=pagination__buttons><span class="button previous"><a href=https://netsplit.uk/posts/2019/02/13/configuring_proxmox/><span class=button__icon>←</span>
<span class=button__text>Remote Lab, Part 2: Configuring Proxmox</span></a></span>
<span class="button next"><a href=https://netsplit.uk/posts/2019/01/09/mattermost-bot/><span class=button__text>Building a Mattermost Chatbot in Perl</span>
<span class=button__icon>→</span></a></span></div></div></div></div><footer class=footer><div class=footer__inner><div class=copyright><span>© 2022 Powered by <a href=http://gohugo.io>Hugo</a></span>
<span>:: Theme made by <a href=https://twitter.com/panr>panr</a></span></div></div></footer><script src=https://netsplit.uk/assets/main.js></script><script src=https://netsplit.uk/assets/prism.js></script></div></body></html>