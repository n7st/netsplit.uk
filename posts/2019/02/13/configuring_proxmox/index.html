<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Part 2: Configuring Proxmox and setting up the base virtual machines for our
remote virtual lab.
"><meta name=keywords content><meta name=robots content="noodp"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="og:title" content="Remote Lab, Part 2: Configuring Proxmox"><meta property="og:description" content="Part 2: Configuring Proxmox and setting up the base virtual machines for our
remote virtual lab.
"><meta property="og:url" content="https://netsplit.uk/posts/2019/02/13/configuring_proxmox/"><meta property="og:site_name" content="netsplit"><link rel=canonical href=https://netsplit.uk/posts/2019/02/13/configuring_proxmox/><link rel=stylesheet type=text/css href=/css/style.css><title>netsplit | Remote Lab, Part 2: Configuring Proxmox</title></head><body><header><nav><ul><li><a href=/>Posts</a></li><li><a href=/about>About</a></li></ul></nav></header><div id=content><article><h1>Remote Lab, Part 2: Configuring Proxmox</h1><p>This article was originally posted on Wednesday, February 13, 2019.</p><ul><li><a href=/posts/2019/02/13/remote_proxmox_lab_intro/>Part 1 (Introduction, OVH configuration.)</a></li><li><a href=#>Part 2 (Configuring Proxmox. You&rsquo;re here!)</a></li><li><a href=/posts/2019/02/17/installing_pfsense/>Part 3 (Installing pfSense.)</a></li><li><a href=/posts/2020/01/11/configuring_pfsense>Part 4 (Configuring pfSense.)</a></li></ul><p>Now, we&rsquo;ll need to install Proxmox on the server. I won&rsquo;t cover the basic
installation in this post, but I am using Proxmox VE 5, which is available as a
template during installation with OVH&rsquo;s wizard.</p><h2 id=securing-proxmoxs-web-interface>Securing Proxmox&rsquo;s web interface <a href=#securing-proxmoxs-web-interface aria-label="Link to this heading">&#8983;</a></h2><p>Once you have installed your hypervisor and logged in, I recommend taking a
couple of extra steps to improve security, because the web interface is public
facing:</p><ol><li>Set up your own administrative user and disable the default one.</li><li>Set up two-factor authentication. I followed
<a href=http://jonspraggins.com/the-idiot-adds-two-factor-authentication-to-proxmox/>this guide</a>.</li><li>Get a valid SSL certificate. I followed
<a href=https://pve.proxmox.com/wiki/HTTPS_Certificate_Configuration_(Version_4.x_and_newer)#Let.27s_Encrypt_using_acme.sh>this guide</a>
to get a certificate from Let&rsquo;s Encrypt using <code>acme.sh</code> (but the steps using
<code>certbot</code> look good, too).</li><li>Disable password authentication over SSH and use key authentication instead.</li></ol><h2 id=disabling-the-enterprise-apt-repository>Disabling the enterprise APT repository <a href=#disabling-the-enterprise-apt-repository aria-label="Link to this heading">&#8983;</a></h2><p>Unless you have a Proxmox subscription, <code>apt</code> will fail with an exit code of 100.
This is because it is trying to read from the subscription-only enterprise APT
repository.</p><p>Comment out the only line in <code>/etc/apt/sources.list.d/pve-enterprise.list</code> and
run <code>apt update</code>.</p><p>Adding the &ldquo;no subscription&rdquo; repository to <code>/etc/apt/sources.list</code> means you will
still receive Proxmox updates:</p><pre><code># Please note that the APT repositories in this sample file use the UK Debian
# mirror
deb http://ftp.uk.debian.org/debian bullseye main contrib

deb http://ftp.uk.debian.org/debian bullseye-updates main contrib

# security updates
deb http://security.debian.org bullseye-security main contrib

# PVE pve-no-subscription repository provided by proxmox.com,
# NOT recommended for production use
deb http://download.proxmox.com/debian/pve bullseye pve-no-subscription
</code></pre><p>See <a href=https://pve.proxmox.com/wiki/Package_Repositories>the Proxmox package repository guide</a> for more information.</p><h2 id=network-bridges>Network bridges <a href=#network-bridges aria-label="Link to this heading">&#8983;</a></h2><p>For the most basic setup, three network bridges are required (which will become
the WAN, LAN and OPT1 interfaces in our router). These are configured in the
host node&rsquo;s network settings.</p><table><thead><tr><th>Name</th><th>Type</th><th>Ports/Slaves</th><th>IP address</th><th>Subnet mask</th><th>Gateway</th></tr></thead><tbody><tr><td>vmbr0</td><td>Linux bridge</td><td>eth0</td><td>Primary IP address (ex. 5.39.50.60)</td><td>255.255.255.0</td><td>Primary gateway address (ex. 5.39.50.254)</td></tr><tr><td>vmbr1</td><td>Linux bridge</td><td>dummy0</td><td>(none)</td><td>(none)</td><td>(none)</td></tr><tr><td>vmbr2</td><td>Linux bridge</td><td>dummy1</td><td>(none)</td><td>(none)</td><td>(none)</td></tr></tbody></table><h2 id=virtual-hardware-for-pfsense>Virtual hardware for pfSense <a href=#virtual-hardware-for-pfsense aria-label="Link to this heading">&#8983;</a></h2><p>Below are the current specifications for my router&rsquo;s virtual hardware. Your
mileage may vary.</p><table><thead><tr><th>Item</th><th>Value</th><th>Notes</th></tr></thead><tbody><tr><td>CPU</td><td>2 vCPUs</td><td>A type of &ldquo;host&rdquo; (for host-passthrough) is required if you would like to use AES-NI CPU cryptography</td></tr><tr><td>RAM</td><td>4G</td><td></td></tr><tr><td>Storage</td><td>32G</td><td>I am using a VirtIO disk</td></tr><tr><td>Network Device 1</td><td>vmbr0, VirtIO (or E1000)</td><td>This will be used as the WAN interface</td></tr><tr><td>Network Device 2</td><td>vmbr1, VirtIO (or E1000)</td><td>This will be used as the LAN interface</td></tr><tr><td>Network Device 3</td><td>vmbr2, VirtIO (or E1000)</td><td>This will be used as the OPT1 interface</td></tr></tbody></table><p>In the next part, we&rsquo;ll install pfSense and configure the basic interfaces.</p><p><em><a href=/posts/2019/02/17/installing_pfsense>Read part 3</a></em></p></article><aside><h2>Tags</h2><ul><li><a href=https://netsplit.uk/tags/remote-lab/>Remote Lab</a></li><li><a href=https://netsplit.uk/tags/proxmox/>Proxmox</a></li><li><a href=https://netsplit.uk/tags/pfsense/>pfSense</a></li><li><a href=https://netsplit.uk/tags/ovh/>OVH</a></li><li><a href=https://netsplit.uk/tags/networking/>Networking</a></li></ul></aside></div><footer><p>Copyright &copy; 2010-2022 Mike Jones</p></footer></body></html>