<!doctype html><html lang=en><head><title>Remote Lab, Part 2: Configuring Proxmox :: netsplit</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Part 1 (Introduction, OVH configuration.) Part 2 (Configuring Proxmox. You&amp;rsquo;re here!) Part 3 (Installing pfSense.) Part 4 (Configuring pfSense.) Now, we&amp;rsquo;ll need to install Proxmox on the server. I won&amp;rsquo;t cover the basic installation in this post, but I am using Proxmox VE 5, which is available as a template during installation with OVH&amp;rsquo;s wizard.
Securing Proxmox&amp;rsquo;s web interface Once you have installed your hypervisor and logged in, I recommend taking a couple of extra steps to improve security, because the web interface is public facing:"><meta name=keywords content><meta name=robots content="noodp"><link rel=canonical href=https://netsplit.uk/posts/2019/02/13/configuring_proxmox/><link rel=stylesheet href=https://netsplit.uk/assets/style.css><link rel=stylesheet href=https://netsplit.uk/assets/green.css><link rel=apple-touch-icon href=https://netsplit.uk/img/apple-touch-icon-192x192.png><link rel="shortcut icon" href=https://netsplit.uk/img/favicon/green.png><meta name=twitter:card content="summary"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="og:title" content="Remote Lab, Part 2: Configuring Proxmox"><meta property="og:description" content="Part 2: Configuring Proxmox and setting up the base virtual machines for our
remote virtual lab.
"><meta property="og:url" content="https://netsplit.uk/posts/2019/02/13/configuring_proxmox/"><meta property="og:site_name" content="netsplit"><meta property="og:image" content="https://netsplit.uk/img/favicon/green.png"><meta property="og:image:width" content="2048"><meta property="og:image:height" content="1024"><meta property="article:published_time" content="2019-02-13 22:02:42 +0000 UTC"></head><body class=green><div class="container full headings--one-size"><header class=header><div class=header__inner><div class=header__logo><a href=/><div class=logo>netsplit</div></a></div><div class=menu-trigger>menu</div></div></header><div class=content><div class=post><h1 class=post-title><a href=https://netsplit.uk/posts/2019/02/13/configuring_proxmox/>Remote Lab, Part 2: Configuring Proxmox</a></h1><div class=post-meta><span class=post-date>2019-02-13 [Updated: 2019-02-13]</span></div><span class=post-tags>#<a href=https://netsplit.uk/tags/remote-lab/>Remote Lab</a>&nbsp;
#<a href=https://netsplit.uk/tags/proxmox/>Proxmox</a>&nbsp;
#<a href=https://netsplit.uk/tags/pfsense/>pfSense</a>&nbsp;
#<a href=https://netsplit.uk/tags/ovh/>OVH</a>&nbsp;
#<a href=https://netsplit.uk/tags/networking/>Networking</a>&nbsp;</span><div class=post-content><div><ul><li><a href=/posts/2019/02/13/remote_proxmox_lab_intro/>Part 1 (Introduction, OVH configuration.)</a></li><li><a href=#>Part 2 (Configuring Proxmox. You&rsquo;re here!)</a></li><li><a href=/posts/2019/02/17/installing_pfsense/>Part 3 (Installing pfSense.)</a></li><li><a href=/posts/2020/01/11/configuring_pfsense>Part 4 (Configuring pfSense.)</a></li></ul><p>Now, we&rsquo;ll need to install Proxmox on the server. I won&rsquo;t cover the basic
installation in this post, but I am using Proxmox VE 5, which is available as a
template during installation with OVH&rsquo;s wizard.</p><h3 id=securing-proxmoxs-web-interface>Securing Proxmox&rsquo;s web interface<a href=#securing-proxmoxs-web-interface class=hanchor arialabel=Anchor>&#8983;</a></h3><p>Once you have installed your hypervisor and logged in, I recommend taking a
couple of extra steps to improve security, because the web interface is public
facing:</p><ol><li>Set up your own administrative user and disable the default one.</li><li>Set up two-factor authentication. I followed
<a href=http://jonspraggins.com/the-idiot-adds-two-factor-authentication-to-proxmox/>this guide</a>.</li><li>Get a valid SSL certificate. I followed
<a href=https://pve.proxmox.com/wiki/HTTPS_Certificate_Configuration_(Version_4.x_and_newer)#Let.27s_Encrypt_using_acme.sh>this guide</a>
to get a certificate from Let&rsquo;s Encrypt using <code>acme.sh</code> (but the steps using
<code>certbot</code> look good, too).</li><li>Disable password authentication over SSH and use key authentication instead.</li></ol><h3 id=disabling-the-enterprise-apt-repository>Disabling the enterprise APT repository<a href=#disabling-the-enterprise-apt-repository class=hanchor arialabel=Anchor>&#8983;</a></h3><p>Unless you have a Proxmox subscription, <code>apt</code> will fail with an exit code of 100.
This is because it is trying to read from the subscription-only enterprise APT
repository.</p><p>Comment out the only line in <code>/etc/apt/sources.list.d/pve-enterprise.list</code> and
run <code>apt update</code>.</p><p>Adding the &ldquo;no subscription&rdquo; repository to <code>/etc/apt/sources.list</code> means you will
still receive Proxmox updates:</p><pre tabindex=0><code># Please note that the APT repositories in this sample file use the UK Debian
# mirror
deb http://ftp.uk.debian.org/debian bullseye main contrib

deb http://ftp.uk.debian.org/debian bullseye-updates main contrib

# security updates
deb http://security.debian.org bullseye-security main contrib

# PVE pve-no-subscription repository provided by proxmox.com,
# NOT recommended for production use
deb http://download.proxmox.com/debian/pve bullseye pve-no-subscription
</code></pre><p>See <a href=https://pve.proxmox.com/wiki/Package_Repositories>here</a> for more information.</p><h3 id=network-bridges>Network bridges<a href=#network-bridges class=hanchor arialabel=Anchor>&#8983;</a></h3><p>For the most basic setup, three network bridges are required (which will become
the WAN, LAN and OPT1 interfaces in our router). These are configured in the
host node&rsquo;s network settings.</p><table><thead><tr><th>Name</th><th>Type</th><th>Ports/Slaves</th><th>IP address</th><th>Subnet mask</th><th>Gateway</th></tr></thead><tbody><tr><td>vmbr0</td><td>Linux bridge</td><td>eth0</td><td>Primary IP address (ex. 5.39.50.60)</td><td>255.255.255.0</td><td>Primary gateway address (ex. 5.39.50.254)</td></tr><tr><td>vmbr1</td><td>Linux bridge</td><td>dummy0</td><td>(none)</td><td>(none)</td><td>(none)</td></tr><tr><td>vmbr2</td><td>Linux bridge</td><td>dummy1</td><td>(none)</td><td>(none)</td><td>(none)</td></tr></tbody></table><h3 id=virtual-hardware-for-pfsense>Virtual hardware for pfSense<a href=#virtual-hardware-for-pfsense class=hanchor arialabel=Anchor>&#8983;</a></h3><p>Below are the current specifications for my router&rsquo;s virtual hardware. Your
mileage may vary.</p><table><thead><tr><th>Item</th><th>Value</th><th>Notes</th></tr></thead><tbody><tr><td>CPU</td><td>2 vCPUs</td><td>A type of &ldquo;host&rdquo; (for host-passthrough) is required if you would like to use AES-NI CPU cryptography</td></tr><tr><td>RAM</td><td>4G</td><td></td></tr><tr><td>Storage</td><td>32G</td><td>I am using a VirtIO disk</td></tr><tr><td>Network Device 1</td><td>vmbr0, VirtIO (or E1000)</td><td>This will be used as the WAN interface</td></tr><tr><td>Network Device 2</td><td>vmbr1, VirtIO (or E1000)</td><td>This will be used as the LAN interface</td></tr><tr><td>Network Device 3</td><td>vmbr2, VirtIO (or E1000)</td><td>This will be used as the OPT1 interface</td></tr></tbody></table><p>In the next part, we&rsquo;ll install pfSense and configure the basic interfaces.</p><p><em><a href=/posts/2019/02/17/installing_pfsense>Read part 3</a></em></p></div></div><div class=pagination><div class=pagination__title><span class=pagination__title-h>Read other posts</span><hr></div><div class=pagination__buttons><span class="button previous"><a href=https://netsplit.uk/posts/2019/02/17/installing_pfsense/><span class=button__icon>←</span>
<span class=button__text>Remote Lab, Part 3: Installing pfSense</span></a></span>
<span class="button next"><a href=https://netsplit.uk/posts/2019/02/13/remote_proxmox_lab_intro/><span class=button__text>Remote Lab, Part 1: Pre-Installation Configuration</span>
<span class=button__icon>→</span></a></span></div></div></div></div><footer class=footer><div class=footer__inner><div class=copyright><span>© 2022 Powered by <a href=http://gohugo.io>Hugo</a></span>
<span>:: Theme made by <a href=https://twitter.com/panr>panr</a></span></div></div></footer><script src=https://netsplit.uk/assets/main.js></script>
<script src=https://netsplit.uk/assets/prism.js></script></div></body></html>