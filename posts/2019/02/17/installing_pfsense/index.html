<!doctype html><html lang=en><head><title>Remote Lab, Part 3: Installing pfSense :: netsplit</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Part 1 (Introduction, OVH configuration.) Part 2 (Configuring Proxmox.) Part 3 (Installing pfSense. You&amp;rsquo;re here!) Part 4 (Configuring pfSense.) First boot At the firewall&amp;rsquo;s first boot, we need to set up the bare minimum for accessing the web interface, where the configuration will be finalised.
VLANs do not need setting up at this time.
Assign vtnet0 (or em0) as the WAN interface. Set the IP address to your first failover IP address (ex."><meta name=keywords content><meta name=robots content="noodp"><link rel=canonical href=https://netsplit.uk/posts/2019/02/17/installing_pfsense/><link rel=stylesheet href=https://netsplit.uk/assets/style.css><link rel=stylesheet href=https://netsplit.uk/assets/green.css><link rel=apple-touch-icon href=https://netsplit.uk/img/apple-touch-icon-192x192.png><link rel="shortcut icon" href=https://netsplit.uk/img/favicon/green.png><meta name=twitter:card content="summary"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="og:title" content="Remote Lab, Part 3: Installing pfSense"><meta property="og:description" content="Part 3: Install pfSense on an OVH dedicated server.
"><meta property="og:url" content="https://netsplit.uk/posts/2019/02/17/installing_pfsense/"><meta property="og:site_name" content="netsplit"><meta property="og:image" content="https://netsplit.uk/img/favicon/green.png"><meta property="og:image:width" content="2048"><meta property="og:image:height" content="1024"><meta property="article:published_time" content="2019-02-17 22:22:25 +0000 UTC"></head><body class=green><div class="container full headings--one-size"><header class=header><div class=header__inner><div class=header__logo><a href=/><div class=logo>netsplit</div></a></div><div class=menu-trigger>menu</div></div></header><div class=content><div class=post><h1 class=post-title><a href=https://netsplit.uk/posts/2019/02/17/installing_pfsense/>Remote Lab, Part 3: Installing pfSense</a></h1><div class=post-meta><span class=post-date>2019-02-17 [Updated: 2019-02-17]</span></div><span class=post-tags>#<a href=https://netsplit.uk/tags/remote-lab/>Remote Lab</a>&nbsp;
#<a href=https://netsplit.uk/tags/ovh/>OVH</a>&nbsp;
#<a href=https://netsplit.uk/tags/networking/>Networking</a>&nbsp;
#<a href=https://netsplit.uk/tags/pfsense/>pfSense</a>&nbsp;</span><div class=post-content><div><ul><li><a href=/posts/2019/02/13/remote_proxmox_lab_intro/>Part 1 (Introduction, OVH configuration.)</a></li><li><a href=/posts/2019/02/13/configuring_proxmox/>Part 2 (Configuring Proxmox.)</a></li><li><a href=#>Part 3 (Installing pfSense. You&rsquo;re here!)</a></li><li><a href=/posts/2020/01/11/configuring_pfsense>Part 4 (Configuring pfSense.)</a></li></ul><h2 id=first-boot>First boot<a href=#first-boot class=hanchor arialabel=Anchor>&#8983;</a></h2><p>At the firewall&rsquo;s first boot, we need to set up the bare minimum for accessing
the web interface, where the configuration will be finalised.</p><p><strong>VLANs do not need setting up at this time.</strong></p><ul><li>Assign vtnet0 (or em0) as the WAN interface. Set the IP address to your first
failover IP address (ex. <code>5.39.60.70</code>).</li><li>Assign vtnet1 (or em1) as the LAN interface.</li><li>Press 2 to set the WAN interface&rsquo;s IP address.</li></ul><p>Next, we need to set up a temporary route to give us access to the web interface.</p><ul><li>From the main menu, press 8 to enter the shell.</li><li>Add a route to the primary IP address&rsquo; gateway: <code>$ route add -net 5.39.50.254/32 -iface vtnet0</code>
making sure you substitute your own gateway IP (and set the iface as <code>em0</code> if
you are using an E1000 network card).</li><li>Set the route as default: <code>$ route add default 5.39.50.254</code> (substituting your
own gateway address).</li><li>Ping an external host to confirm internet access (<code>$ ping 8.8.8.8</code>).</li></ul><h2 id=temporarily-disable-the-firewall>Temporarily disable the firewall<a href=#temporarily-disable-the-firewall class=hanchor arialabel=Anchor>&#8983;</a></h2><p>Before the firewall is properly configured, the firewall will need disabling so
you have access to the web interface. This is a temporary measure until we have
given ourselves permanent access with a firewall rule, but it does mean that
this section of the guide must be completed quickly (to reduce the amount of
time the web interface is open to the internet). If you do not have a static IP
address at home, you may want to set this to the IP of your own VPN service
(which you could set up on the router by following
<a href=https://doc.pfsense.org/index.php/OpenVPN_Remote_Access_Server>this guide</a>).</p><p>In the pfSense console, temporarily disable the firewall: <code>$ pfctl -d</code>.</p><p>If you need to pause setup for any meaningful length of time, the firewall can
be enabled from the console using <code>$ pfctl -e</code>.</p><h2 id=first-connection-to-the-web-interface>First connection to the web interface<a href=#first-connection-to-the-web-interface class=hanchor arialabel=Anchor>&#8983;</a></h2><ol><li>Navigate to the web interface (in this example, <a href=https://pf.example.com/)>https://pf.example.com/)</a>.</li><li>Log in with the default username and password (<code>admin</code> and <code>pfsense</code>).</li><li>Skip the first-login wizard.</li><li>Change the password for the default user (just in case):<ol><li>From the &ldquo;System&rdquo; menu, choose &ldquo;User Management&rdquo;.</li><li>Edit the &ldquo;admin&rdquo; user.</li><li>Change the password.</li></ol></li></ol><p>Later, you should disable the administrative user and add your own.</p><h2 id=finalise-configuration-for-the-wan-interface>Finalise configuration for the WAN interface<a href=#finalise-configuration-for-the-wan-interface class=hanchor arialabel=Anchor>&#8983;</a></h2><ol><li>From the &ldquo;System&rdquo; menu, select &ldquo;Routing&rdquo;.</li><li>Under the &ldquo;Gateways&rdquo; tab (which is selected by default), add a new gateway.</li><li>Fill in the form:<ul><li>Interface: WAN</li><li>Address family: IPv4</li><li>Name: <code>OVH_Primary</code></li><li>Gateway: <code>5.39.50.254</code></li><li>Default gateway: (checked)</li><li>Show advanced</li><li>Weight: 1</li><li>Use non-local gateway: (checked)</li></ul></li></ol><p>Configuration changes restart the pf firewall, so you will need to stop it again
to finish the configuration.</p><p>Next, we need to set the correct address for the interface.</p><ol><li>From the &ldquo;Interfaces&rdquo; menu, select &ldquo;WAN&rdquo;.</li><li>Fill in the form:<ul><li>MAC address: <code>02:01:01:e4:44:44</code> (the virtual MAC address we created earlier).</li><li>IPv4 address: <code>5.39.60.70</code></li><li>IPv4 upstream gateway: <code>OVH_Primary</code> (the gateway we just created)</li><li>Block bogon networks: (checked)</li></ul></li></ol><p>Once again, this will enable the firewall, so you will need to disable it again
in order to whitelist a management IP address.</p><h2 id=whitelist-a-management-ip>Whitelist a management IP<a href=#whitelist-a-management-ip class=hanchor arialabel=Anchor>&#8983;</a></h2><ol><li>From the &ldquo;Firewall&rdquo; menu, select &ldquo;Aliases&rdquo; and click &ldquo;Add&rdquo;.</li><li>Fill in the form:<ul><li>Name: Management</li><li>Description: Addresses to allow full access to the web interface</li><li>Type: Host(s)</li><li>IP or FQDN: (your home IP address)</li></ul></li><li>Click &ldquo;Save&rdquo;.</li><li>From the &ldquo;Firewall&rdquo; menu, &ldquo;Rules&rdquo;, choose the &ldquo;WAN&rdquo; tab, and click &ldquo;Add&rdquo;.</li><li>Fill in the form:<ul><li>Action: Pass</li><li>Interface: WAN</li><li>Source: Single host or alias</li><li>Source address: Management</li><li>Destination: This firewall (self)</li><li>Log packets that are handled by this rule</li><li>Description: Permit remote access to the web interface</li></ul></li><li>Click &ldquo;Save&rdquo;, and apply the rule. This will restart the firewall (undoing
step 1, and resecuring the router).</li></ol><h2 id=configuring-the-lan-and-opt1-interfaces>Configuring the LAN and OPT1 interfaces<a href=#configuring-the-lan-and-opt1-interfaces class=hanchor arialabel=Anchor>&#8983;</a></h2><ul><li>The LAN interface should be static IPv4 with an IPv4 address of
<code>192.168.1.1/24</code> (or another sensible reserved range, documented
<a href=https://en.wikipedia.org/wiki/Reserved_IP_addresses>here</a>). There should not
be an upstream gateway.</li><li>The OPT1 interface should be static IPv4 with an IPv4 address of
<code>10.5.4.1/24</code> (or, as above, another sensible reserved range). There should not
be an upstream gateway.</li></ul><h2 id=disable-hardware-checksum-offload>Disable hardware checksum offload<a href=#disable-hardware-checksum-offload class=hanchor arialabel=Anchor>&#8983;</a></h2><blockquote><p>Checksum offloading is broken in some hardware, particularly some Realtek cards.
Rarely, drivers may have problems with checksum offloading and some specific NICs.
This will take effect after a machine reboot or re-configure of each interface.</p></blockquote><p>The network cards in SoYouStart machines do not appear to support hardware
checksum offloading (this may need confirming from other sources, but the card
in mine certainly doesn&rsquo;t).</p><ol><li>From the &ldquo;System&rdquo; menu, select &ldquo;Advanced&rdquo; and then go to the &ldquo;Networking&rdquo; tab.</li><li>Check &ldquo;Disable hardware checksum offload&rdquo;.</li><li>Reboot the system (&ldquo;Halt system&rdquo; under the &ldquo;Diagnostics&rdquo; menu).</li></ol></div></div><div class=pagination><div class=pagination__title><span class=pagination__title-h>Read other posts</span><hr></div><div class=pagination__buttons><span class="button previous"><a href=https://netsplit.uk/posts/2020/01/11/configuring_pfsense/><span class=button__icon>←</span>
<span class=button__text>Remote Lab, Part 4: Configuring pfSense</span></a></span>
<span class="button next"><a href=https://netsplit.uk/posts/2019/02/13/configuring_proxmox/><span class=button__text>Remote Lab, Part 2: Configuring Proxmox</span>
<span class=button__icon>→</span></a></span></div></div></div></div><footer class=footer><div class=footer__inner><div class=copyright><span>© 2022 Powered by <a href=http://gohugo.io>Hugo</a></span>
<span>:: Theme made by <a href=https://twitter.com/panr>panr</a></span></div></div></footer><script src=https://netsplit.uk/assets/main.js></script>
<script src=https://netsplit.uk/assets/prism.js></script></div></body></html>