<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="This is a guide on how to set up Cisco 7941G phones as an intercom system.
"><meta name=keywords content><meta name=robots content="noodp"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="og:title" content="Setting up a home intercom using Cisco 7941G phones"><meta property="og:description" content="This is a guide on how to set up Cisco 7941G phones as an intercom system.
"><meta property="og:url" content="https://netsplit.uk/posts/2025/05/09/home-cisco-intercom/"><meta property="og:site_name" content="netsplit"><link rel=canonical href=https://netsplit.uk/posts/2025/05/09/home-cisco-intercom/><link rel=stylesheet type=text/css href=/css/style.css><title>netsplit | Setting up a home intercom using Cisco 7941G phones</title></head><body><header><nav><ul><li class=site-title><strong>Mike Jones</strong></li><li><a href=/>Posts</a></li><li><a href=/about>About</a></li><li><a href=/projects>Projects</a></li></ul></nav></header><div id=content><article><h1>Setting up a home intercom using Cisco 7941G phones</h1><p>This article was originally posted on Friday, May 9, 2025 at 22:58:00.</p><aside><h2>Table of contents</h2><nav id=TableOfContents><ul><li><a href=#introduction>Introduction</a></li><li><a href=#setting-up-an-intercom-system-of-your-own>Setting up an intercom system of your own</a><ul><li><a href=#prerequisites>Prerequisites</a></li><li><a href=#setting-up-your-home-network>Setting up your home network</a></li><li><a href=#making-the-ansible-playbook-your-own>Making the Ansible playbook your own</a></li><li><a href=#deploying-the-ansible-playbook>Deploying the Ansible playbook</a></li><li><a href=#verifying-the-system>Verifying the system</a></li></ul></li><li><a href=#resources>Resources</a></li><li><a href=#pitfalls>Pitfalls</a></li><li><a href=#debugging-asterisk>Debugging Asterisk</a></li></ul></nav><aside><h2 id=introduction>Introduction <a href=#introduction aria-label="Link to this heading">&#8983;</a></h2><p>Recently, I have been working on configuring several <a href=https://www.cisco.com/web/ANZ/cpp/refguide/hview/ipt/phone.html#7940g>Cisco 7941G</a>
phones as an intercom between my house and workshop.</p><p>I chose to standardise on the Cisco 7941G for two reasons:</p><ol><li>A friend lent me one for testing.</li><li>They&rsquo;re cheap and readily available on eBay.</li></ol><p>The system now consists of three phones and a Raspberry Pi 4B.</p><p>The phones run Cisco&rsquo;s SIP firmware, which talks to <a href=https://www.pjsip.org/>PJSIP</a>
and <a href=https://www.asterisk.org/>Asterisk</a> on the Raspberry Pi. TFTP provides
firmware and configuration to the phones. NGINX serves up the telephone
directory, making it simpler to make calls within your network.</p><p>At the time of writing, <a href=https://www.freepbx.org/>FreePBX</a> do not officially
support installations on Raspberry Pis, hence choosing plain Asterisk. It
would probably also be overkill for a small network.</p><p>I chose to run PJSIP instead of SIP due to SIP being removed in recent versions
of Asterisk.</p><h2 id=setting-up-an-intercom-system-of-your-own>Setting up an intercom system of your own <a href=#setting-up-an-intercom-system-of-your-own aria-label="Link to this heading">&#8983;</a></h2><p>After spending quite a lot of time configuring individual phones by hand, I
decided that Ansible would be a good fit for managing the configuration for the
various services involved in the system.</p><p>If you would like to set up your own intercom system, it is available
<a href=https://git.taula.org/mike/ansible-asterisk-cisco-intercom>here</a>.</p><h3 id=prerequisites>Prerequisites <a href=#prerequisites aria-label="Link to this heading">&#8983;</a></h3><p>A few things are required to set up your own system.</p><ul><li>At least two Cisco 7941G phones.</li><li>A copy of the SIP firmware for the Cisco 7941G phone. I cannot provide this
due to Cisco&rsquo;s licence, but it&rsquo;s easy to find with a cursory Google search.</li><li>A Raspberry Pi with Debian 12 installed on it.</li></ul><p>It would also be helpful to have a basic knowledge of computer networking.</p><h3 id=setting-up-your-home-network>Setting up your home network <a href=#setting-up-your-home-network aria-label="Link to this heading">&#8983;</a></h3><p>You will need a means of configuring static IP addresses for devices on your
network and a way of setting TFTP boot options based on MAC addresses. This is
all handled by <a href=https://opnsense.org/>OPNsense</a>, which I run on my router.</p><h4 id=static-dhcp>Static DHCP <a href=#static-dhcp aria-label="Link to this heading">&#8983;</a></h4><p>Both the Raspberry Pi and SIP phones will need to have static IPv4 addresses
configured in your DHCP settings.</p><h4 id=booting-from-tftp>Booting from TFTP <a href=#booting-from-tftp aria-label="Link to this heading">&#8983;</a></h4><p>The SIP phones netboot over TFTP. When you deploy the Ansible playbook, it sets
up the TFTP server with configuration for the phones and the firmware they need
to boot.</p><p>In OPNsense, TFTP booting can be configured on a per-MAC address basis in the
static DHCP mapping which was set up in the last step. It is hidden under an
advanced menu (Advanced - Show TFTP configuration).</p><table><thead><tr><th style=text-align:left>Form field</th><th style=text-align:left>Value</th></tr></thead><tbody><tr><td style=text-align:left>Set TFTP hostname</td><td style=text-align:left><code>&lt;the IP address or hostname of your Raspberry Pi></code></td></tr><tr><td style=text-align:left>Set bootfile</td><td style=text-align:left><code>/srv/tftp/term41.default.loads</code></td></tr></tbody></table><p>The bootfile is automatically placed in the correct location by the Ansible
playbook, so this path should always be the same.</p><h3 id=making-the-ansible-playbook-your-own>Making the Ansible playbook your own <a href=#making-the-ansible-playbook-your-own aria-label="Link to this heading">&#8983;</a></h3><p>Before the playbook can be run, there are two main requirements.</p><p>Firstly, you must find a copy of the SIP firmware for the phones. The following
files are required:</p><ul><li><code>apps41.8-5-2TH1-9.sbn</code></li><li><code>cnu41.8-5-2TH1-9.sbn</code></li><li><code>cvm41sip.8-5-2TH1-9.sbn</code></li><li><code>dsp41.8-5-2TH1-9.sbn</code></li><li><code>jar41sip.8-5-2TH1-9.sbn</code></li><li><code>SIP41.8-5-2S.loads</code></li><li><code>term41.default.loads</code></li></ul><p>They need adding to the <code>roles/tftp/files/firmware/</code> directory in the Ansible
project. If you try to run the playbook without them, an error will be thrown.</p><p>Some configuration is also required:</p><h4 id=inventoriesproductionhostsini><code>inventories/production/hosts.ini</code> <a href=#inventoriesproductionhostsini aria-label="Link to this heading">&#8983;</a></h4><p>There are placeholders for the Asterisk, NGINX and TFTP servers. They can all be
the same server (in my case, the Raspberry Pi).</p><h4 id=inventoriesproductiongroup_varsallyml><code>inventories/production/group_vars/all.yml</code> <a href=#inventoriesproductiongroup_varsallyml aria-label="Link to this heading">&#8983;</a></h4><p>There are two example configurations for SIP phones. You will need to set the
MAC and IPv4 address for each phone.</p><p>In order to find the MAC, you can (after powering on a phone) visit the web
interface running on it. The &ldquo;Host Name&rdquo; should be set as the MAC in the
configuration.</p><h3 id=deploying-the-ansible-playbook>Deploying the Ansible playbook <a href=#deploying-the-ansible-playbook aria-label="Link to this heading">&#8983;</a></h3><pre><code class=language-bash>ansible-playbook -i inventories/production/hosts.ini site.yml
</code></pre><h3 id=verifying-the-system>Verifying the system <a href=#verifying-the-system aria-label="Link to this heading">&#8983;</a></h3><p>After deploying the playbook, you should restart the phones and watch them boot
up. You should see the number you have configured on the screen, and the phone
icon on the right hand side should not have a cross next to it. If this is the
case, try making a call to one of your other extensions.</p><p>If you&rsquo;re having issues, try <a href=#debugging-asterisk>Debugging Asterisk</a>.</p><h2 id=resources>Resources <a href=#resources aria-label="Link to this heading">&#8983;</a></h2><p>Whilst configuring the system, I found a couple of useful resources:</p><ul><li><a href=https://www.whizzy.org/2017/02/23/cisco-7941-asterisk-and-sip/>Cisco 7941, Asterisk and SIP</a></li><li><a href=https://usecallmanager>USECALLMANAGER.nz</a></li></ul><h2 id=pitfalls>Pitfalls <a href=#pitfalls aria-label="Link to this heading">&#8983;</a></h2><p>The biggest issue I faced whilst setting up the phones was that they silently
fall back to old configurations if they fail validation or are absent. I
discovered that two of my phones could receive calls, but (as far as I could tell)
couldn&rsquo;t make them.</p><p>This had been caused by an abscence of a &ldquo;dialplan&rdquo; for the phones, meaning they
were falling back to configuration from their original network. That dialplan,
which I couldn&rsquo;t view, may have had an option to immediately connect when the
number &ldquo;1&rdquo; was entered. This, combined with the fact that I had chosen &ldquo;1&rdquo; as
the prefix for all my phone numbers, meant that the phones were unable to make
any calls.</p><h2 id=debugging-asterisk>Debugging Asterisk <a href=#debugging-asterisk aria-label="Link to this heading">&#8983;</a></h2><p>If you have any issues with setting up the phones (registration failures, calls
not being made), it can be helpful to watch traffic on the SIP port on the server:</p><pre><code class=language-bash>sudo tcpdump -i any -n port 5060 and udp
</code></pre><p>You can also log into the Asterisk console and watch the debugging output:</p><pre><code class=language-bash>sudo asterisk -rvvvvv
</code></pre><pre><code class=language-bash>pjsip set logger on
</code></pre><p>Booting a phone or attempting to make a phone call should make any problems
clear.</p></article><aside><h2>Tags</h2><ul><li><a href=https://netsplit.uk/tags/tutorial/>Tutorial</a></li><li><a href=https://netsplit.uk/tags/networking/>Networking</a></li><li><a href=https://netsplit.uk/tags/telephony/>Telephony</a></li></ul></aside></div><footer><p>Copyright &copy; 2014-2025 Mike Jones</p></footer></body></html>